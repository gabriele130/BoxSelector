<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StackBlitz Debug Page</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #131313;
            color: #eee;
            line-height: 1.6;
        }
        h1 { color: #3b82f6; }
        h2 { color: #60a5fa; margin-top: 30px; }
        pre {
            background-color: #1e1e1e;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border-left: 3px solid #3b82f6;
        }
        .card {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #2563eb;
        }
        .error { color: #f87171; }
        .success { color: #34d399; }
        .warning { color: #fbbf24; }
    </style>
</head>
<body>
    <h1>StackBlitz React Debug Center</h1>
    <p>Questa pagina diagnostica i problemi di avvio dell'applicazione React in StackBlitz.</p>
    
    <div class="card">
        <h2>Informazioni Ambiente</h2>
        <div id="env-info"></div>
    </div>

    <div class="card">
        <h2>Test di base React</h2>
        <div id="react-test-container"></div>
        <div id="react-test-result"></div>
        <button onclick="testReactBasic()">Test React Base</button>
    </div>

    <div class="card">
        <h2>Test DOM e Rendering</h2>
        <div id="dom-test-result"></div>
        <button onclick="testDOMRender()">Test DOM</button>
    </div>

    <div class="card">
        <h2>Test Import ESM</h2>
        <div id="import-test-result"></div>
        <button onclick="testImports()">Test Imports</button>
    </div>

    <div class="card">
        <h2>Test Caricamento Moduli</h2>
        <div id="module-loader-result"></div>
        <button onclick="testModuleLoading()">Test Moduli</button>
    </div>

    <div class="card">
        <h2>Console Log</h2>
        <div id="console-container">
            <pre id="console-output"><em>I log della console appariranno qui...</em></pre>
        </div>
    </div>

    <script type="module">
        // Mostra informazioni sull'ambiente
        const envInfo = document.getElementById('env-info');
        const envDetails = {
            userAgent: navigator.userAgent,
            screenSize: `${window.innerWidth}x${window.innerHeight}`,
            pixelRatio: window.devicePixelRatio,
            cookiesEnabled: navigator.cookieEnabled,
            language: navigator.language,
            platform: navigator.platform,
            online: navigator.onLine
        };

        let envHTML = '<pre>';
        for (const [key, value] of Object.entries(envDetails)) {
            envHTML += `${key}: ${value}\n`;
        }
        envHTML += '</pre>';
        envInfo.innerHTML = envHTML;

        // Cattura i log della console
        const consoleOutput = document.getElementById('console-output');
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn,
            info: console.info
        };

        function formatArg(arg) {
            if (typeof arg === 'object') {
                try {
                    return JSON.stringify(arg, null, 2);
                } catch (e) {
                    return String(arg);
                }
            }
            return String(arg);
        }

        console.log = function(...args) {
            originalConsole.log.apply(console, args);
            appendToConsole('log', args);
        };
        
        console.error = function(...args) {
            originalConsole.error.apply(console, args);
            appendToConsole('error', args);
        };
        
        console.warn = function(...args) {
            originalConsole.warn.apply(console, args);
            appendToConsole('warning', args);
        };
        
        console.info = function(...args) {
            originalConsole.info.apply(console, args);
            appendToConsole('info', args);
        };

        function appendToConsole(type, args) {
            if (consoleOutput.innerHTML.includes('I log della console appariranno qui')) {
                consoleOutput.innerHTML = '';
            }
            
            const formattedArgs = args.map(formatArg).join(' ');
            const logLine = `<span class="${type}">[${type.toUpperCase()}] ${formattedArgs}</span>\n`;
            consoleOutput.innerHTML += logLine;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        window.testReactBasic = async function() {
            const resultContainer = document.getElementById('react-test-result');
            resultContainer.innerHTML = '<p>Test in corso...</p>';
            
            try {
                const React = await import('react');
                const ReactDOM = await import('react-dom');
                const reactContainer = document.getElementById('react-test-container');
                
                const App = React.createElement('div', {
                    style: {
                        backgroundColor: '#3b82f6',
                        color: 'white',
                        padding: '10px',
                        borderRadius: '4px',
                        marginBottom: '10px'
                    }
                }, 'React funziona correttamente!');
                
                ReactDOM.render(App, reactContainer);
                
                resultContainer.innerHTML = `
                    <p class="success">✅ React caricato correttamente</p>
                    <p>Versione React: ${React.version}</p>
                `;
            } catch (error) {
                resultContainer.innerHTML = `
                    <p class="error">❌ Errore durante il caricamento di React</p>
                    <pre>${error.message}\n${error.stack}</pre>
                `;
                console.error('React test error:', error);
            }
        };

        window.testDOMRender = function() {
            const resultContainer = document.getElementById('dom-test-result');
            resultContainer.innerHTML = '<p>Test in corso...</p>';
            
            try {
                // Controlla elementi chiave
                const rootElement = document.getElementById('root');
                const rootStatus = rootElement ? 'trovato' : 'non trovato';
                
                // Test di renderizzazione DOM base
                const testElement = document.createElement('div');
                testElement.textContent = 'Test DOM elementare';
                testElement.style.backgroundColor = '#3b82f6';
                testElement.style.color = 'white';
                testElement.style.padding = '10px';
                testElement.style.borderRadius = '4px';
                testElement.style.marginTop = '10px';
                
                resultContainer.appendChild(testElement);
                
                resultContainer.innerHTML += `
                    <p class="success">✅ Test DOM riuscito</p>
                    <p>Elemento root: <span class="${rootStatus === 'trovato' ? 'success' : 'error'}">${rootStatus}</span></p>
                `;
                
                if (!rootElement) {
                    resultContainer.innerHTML += `
                        <p class="warning">⚠️ L'elemento root non è presente nel DOM. Questo è essenziale per il rendering React.</p>
                    `;
                }
            } catch (error) {
                resultContainer.innerHTML = `
                    <p class="error">❌ Errore durante il test DOM</p>
                    <pre>${error.message}\n${error.stack}</pre>
                `;
                console.error('DOM test error:', error);
            }
        };

        window.testImports = async function() {
            const resultContainer = document.getElementById('import-test-result');
            resultContainer.innerHTML = '<p>Test in corso...</p>';
            
            const results = [];
            
            try {
                // Test di importazioni comuni
                try {
                    const React = await import('react');
                    results.push({ name: 'react', status: 'success', version: React.version });
                } catch (e) {
                    results.push({ name: 'react', status: 'error', error: e.message });
                }
                
                try {
                    const ReactDOM = await import('react-dom');
                    results.push({ name: 'react-dom', status: 'success', version: ReactDOM.version });
                } catch (e) {
                    results.push({ name: 'react-dom', status: 'error', error: e.message });
                }
                
                // Render risultati
                let resultsHTML = '<ul style="list-style: none; padding: 0;">';
                results.forEach(result => {
                    resultsHTML += `
                        <li style="margin-bottom: 5px;">
                            <span class="${result.status === 'success' ? 'success' : 'error'}">
                                ${result.status === 'success' ? '✅' : '❌'}
                            </span>
                            <strong>${result.name}</strong>: 
                            ${result.status === 'success' 
                                ? `caricato correttamente ${result.version ? `(v${result.version})` : ''}` 
                                : `errore - ${result.error}`}
                        </li>
                    `;
                });
                resultsHTML += '</ul>';
                
                resultContainer.innerHTML = resultsHTML;
            } catch (error) {
                resultContainer.innerHTML = `
                    <p class="error">❌ Errore generale durante i test di importazione</p>
                    <pre>${error.message}\n${error.stack}</pre>
                `;
                console.error('Import test error:', error);
            }
        };

        window.testModuleLoading = async function() {
            const resultContainer = document.getElementById('module-loader-result');
            resultContainer.innerHTML = '<p>Test in corso...</p>';
            
            try {
                // Test caricamento dinamico
                const testModuleURL = '/src/main.tsx'; // o altro modulo principale
                const moduleStatus = document.createElement('p');
                moduleStatus.textContent = `Tentativo di caricare: ${testModuleURL}`;
                resultContainer.innerHTML = '';
                resultContainer.appendChild(moduleStatus);
                
                try {
                    const testScript = document.createElement('script');
                    testScript.type = 'module';
                    testScript.src = testModuleURL;
                    
                    // Tracking
                    testScript.onload = () => {
                        moduleStatus.className = 'success';
                        moduleStatus.textContent = `✅ Modulo ${testModuleURL} caricato correttamente`;
                    };
                    
                    testScript.onerror = (e) => {
                        moduleStatus.className = 'error';
                        moduleStatus.textContent = `❌ Errore caricamento modulo ${testModuleURL}: ${e.type}`;
                        console.error('Module loading error:', e);
                    };
                    
                    document.body.appendChild(testScript);
                    
                    resultContainer.innerHTML += `
                        <p>Tentativo di caricamento in corso...</p>
                        <p class="warning">⚠️ Controlla la console per eventuali errori CORS o sintassi</p>
                    `;
                } catch (e) {
                    moduleStatus.className = 'error';
                    moduleStatus.textContent = `❌ Eccezione durante tentativo di caricamento: ${e.message}`;
                }
                
            } catch (error) {
                resultContainer.innerHTML = `
                    <p class="error">❌ Errore durante il test di caricamento moduli</p>
                    <pre>${error.message}\n${error.stack}</pre>
                `;
                console.error('Module loader test error:', error);
            }
        };

        // Log versione pagina
        console.log('StackBlitz Debug Page loaded at', new Date().toLocaleString());
        console.log('Esegui i test facendo clic sui pulsanti in alto');
    </script>
</body>
</html>